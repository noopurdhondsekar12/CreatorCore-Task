# CreatorCore Database Schema

## Overview
The CreatorCore backend uses MongoDB to store generations, feedback, and embeddings. The database is named `creatorcore`.

## Collections

### generations
Stores all content generations with metadata, feedback, and embeddings.

**Schema:**
```javascript
{
  _id: ObjectId,           // Auto-generated by MongoDB
  topic: String,           // Required: Topic of the generation
  goal: String,            // Required: Goal/purpose of the generation
  output_text: String,     // Required: Generated content text
  tokens_used: Number,     // Required: Estimated token count
  timestamp: String,       // Required: ISO 8601 UTC timestamp
  iteration: String,       // Required: Iteration number for topic
  feedback: String,        // Optional: User feedback text
  feedback_score: Number,  // Optional: Cumulative score from feedback (default: 0.0)
  embedding: [Number],     // Optional: Vector embedding array
  embedding_updated: String // Optional: ISO 8601 timestamp of embedding update
}
```

**Indexes:**
- `{topic: 1, timestamp: -1}` - For efficient history retrieval
- `{embedding: 1}` - For vector similarity searches (if supported by MongoDB Atlas)
- `{iteration: -1}` - For finding latest iterations

**Relationships:**
- None (single collection design for simplicity)

### feedback_loops (Future Use)
Reserved for more complex feedback tracking if needed.

## Data Flow

### Generation Creation
1. New document inserted with basic fields
2. Embedding generated and stored
3. Feedback can be added later, updating score

### Query Patterns
- Find latest generation by topic: `findOne({topic}, {sort: {timestamp: -1}})`
- Find generations with embeddings: `find({embedding: {$exists: true}})`
- Update feedback: `updateOne({_id}, {$set: {feedback, feedback_score}})`

## Migration Strategy

### Version 1.0 (Current)
- Basic generation storage
- No embeddings
- No feedback scores

### Version 2.0 (This Sprint)
- Added `embedding` field
- Added `feedback_score` field
- Added `embedding_updated` field

### Migration Script
See `migrate_db.py` for backfilling embeddings on existing data.

## Constraints

### Required Fields
- topic, goal, output_text, tokens_used, timestamp, iteration

### Data Types
- All strings are UTF-8
- Numbers are integers or floats as appropriate
- Arrays are used for embeddings (384-dimensional vectors)

### Validation
- Client-side validation in Flask app
- No MongoDB schema validation (flexible document structure)

## Performance Considerations

- Embeddings are stored as arrays (consider GridFS for very large vectors if needed)
- Similarity search done in application code (consider MongoDB Atlas Vector Search for production)
- Indexes on frequently queried fields

## Backup Strategy

- Regular MongoDB dumps
- Export embeddings separately if needed
- Version control for schema changes